package config

import (
	valid "github.com/asaskevich/govalidator"
	"github.com/inconshreveable/log15"
)

// Conf has Configuration
var Conf Config

// Config has config
type Config struct {
	Debug    bool
	DebugSQL bool
	Quiet    bool

	DumpPath string
	DBPath   string
	DBType   string

	FetchJvnWeek       bool
	FetchJvnMonth      bool
	FetchJvnEntire     bool
	FetchJvnPeriodChar string

	Bind string `valid:"ipv4"`
	Port string `valid:"port"`

	//TODO validate
	HTTPProxy string
}

// Validate validates configuration
func (c *Config) Validate() bool {
	if c.DBType == "sqlite3" {
		if ok, _ := valid.IsFilePath(c.DBPath); !ok {
			log15.Error("SQLite3 DB path must be a *Absolute* file path.", "dbpath", c.DBPath)
			return false
		}
	}

	if len(c.DumpPath) != 0 {
		if ok, _ := valid.IsFilePath(c.DumpPath); !ok {
			log15.Error("JSON path must be a *Absolute* file path.", "dumppath", c.DumpPath)
			return false
		}
	}

	_, err := valid.ValidateStruct(c)
	if err != nil {
		log15.Error("Invalid Struct.", "err", err)
		return false
	}
	return true
}
