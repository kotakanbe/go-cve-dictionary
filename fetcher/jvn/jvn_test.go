package jvn

import (
	"reflect"
	"testing"

	"github.com/kotakanbe/go-cve-dictionary/models"
)

func TestDistributeCvesByYear(t *testing.T) {
	var tests = []struct {
		in       map[string]models.Jvn
		expected map[string]map[string]models.Jvn
	}{
		{
			in: map[string]models.Jvn{
				"JVNDB-2021-0001#CVE-2021-0001": {JvnID: "JVNDB-2021-0001", CveID: "CVE-2021-0001"},
				"JVNDB-2021-0001#CVE-2020-0001": {JvnID: "JVNDB-2021-0001", CveID: "CVE-2020-0001"},
				"JVNDB-2020-0001#CVE-2020-0001": {JvnID: "JVNDB-2020-0001", CveID: "CVE-2020-0001"},
			},
			expected: map[string]map[string]models.Jvn{
				"2020": {
					"JVNDB-2020-0001#CVE-2020-0001": {JvnID: "JVNDB-2020-0001", CveID: "CVE-2020-0001"},
				},
				"2021": {
					"JVNDB-2021-0001#CVE-2021-0001": {JvnID: "JVNDB-2021-0001", CveID: "CVE-2021-0001"},
					"JVNDB-2021-0001#CVE-2020-0001": {JvnID: "JVNDB-2021-0001", CveID: "CVE-2020-0001"},
				},
			},
		},
	}

	for i, tt := range tests {
		got := map[string]map[string]models.Jvn{}
		distributeCvesByYear(got, tt.in)
		if !reflect.DeepEqual(got, tt.expected) {
			t.Errorf("[%d] expected: %v\n  actual: %v\n", i, tt.expected, got)
		}
	}
}
